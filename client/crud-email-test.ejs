<!DOCTYPE html>
<html>
<head>
<% include partials/header.html %>
</head>
<body>
<% include partials/nav.html %>

<div class="col-sm-9 col-sm-offset-3 col-lg-10 col-lg-offset-2 main" 
     ng-app="SWEApp" ng-controller="EmailTestController" ng-init="init()">

    <!-- End of filters -->
    <!-- Start of accordion content -->

    <div class="row">
      <div class="col-md-12">
        <div class="container-accordion">
          <div class="accordion">
            <dl>
              <!-- make this into a compenent/partial -->
              <!-- to be it for user view -->
              <div ng-repeat="loan in loans | orderBy:'updated_at':reverse">
                <!-- filter:searchText -->
              <dt>
                <a href="#accordion{{$index}}" aria-expanded="false" aria-controls="accordion{{$index}}" class="accordion-title accordionTitle js-accordionTrigger">
                  {{loan.name}} â€“ Loan #{{loan._id}}
                </a>
              </dt>
              <dd class="accordion-content accordionItem" for="accordion{{$index}}">
                <% include partials/progress-row.ejs %>

                <div class="row">
                    <div class="col-xs-11 no-padding">
                        <div class="panel panel-default chat">
                            <div class="panel-heading">
                                Comments
                            </div>
                            <div class="panel-body">
                                <ul ng-repeat="comment in loan.comments | orderBy:'time':reverse_comments">
                                    <li class="left clearfix"><span class="chat-img pull-left">
                                        <div class="chat-body clearfix">
                                            <div class="header">
                                              <strong class="primary-font" 
                                                      ng-if="comment.admin && user_isAdmin">
                                                  Admin Only
                                              </strong>
                                              <small class="text-muted">{{comment.time}}</small>
                                            </div>
                                            <p>{{comment.content}}</p>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                            <div class="panel-footer">
                                <div class="input-group">
                                  <form style="display: flex;">
                                    <input type="text" class="form-control input-md" 
                                           placeholder="Type your message here..." 
                                           id="{{loan._id}}-new-comment"/>
                                    <span class="input-group-btn">
                                      <button class="btn btn-primary btn-md" 
                                        ng-click="addComment(loan._id)">
                                        Comment
                                      </button>
                                      <!-- ng-show="loan.user_email" -->
                                      <button class="btn btn-warning btn-md" 
                                        ng-click="emailClient(loan._id, loan.user_email, loan.name)">
                                        Email
                                      </button>
                                      <button class="btn btn-danger btn-md" ng-click="removeLoan(loan._id)">
                                        <!-- Add BIG ASS WARNING Modal -->
                                        Archieve
                                      </button>
                                    </span>
                                  </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
              </dd>
              </div>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- 
    <a href="http://swe-2017.herokuapp.com/loan/" target="_blank"> helloooo test </a>
     -->

    <form ng-submit="addLoan()">
      <h3>New Loan</h3>
      <input placeholder="Name" type="text" ng-model="newLoan.name" required>
      <input placeholder="Email" type="email" ng-model="newLoan.user_email">
      <input type="submit" class="btn btn-default">
      <input type="submit" style="display: none">
    </form>
</div>

<% include partials/footer.html %>

<script src="js/classie.js"></script>
<script src="js/uisearch.js"></script>
<script src="js/accord.js"></script>

</body>
</html>